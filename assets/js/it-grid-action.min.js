function saveRow(a,b,c,d){var e=$(a).closest("tr"),f=e.find("input, textarea, select").serialize();return console.log(f),$.ajax({url:c,type:"post",data:f,success:function(a){console.log(a),e.find(".help-block").html("");var c=a.errors;if(0==c.length)e.removeClass(itChangeCss),updateRowData(e,b,a.result),d||(disableInputs(e),toggleButtons(e));else{var f=Object.keys(c),g="";for(i=0;i<f.length;i++){""==g&&"*"!=f[i]&&(g=f[i]);var h="*"==f[i]?g:f[i];e.find(".error-"+h).append(c[f[i]][0]).append("<br/>")}}}}),!1}function cancelRow(a,b,c,d){var e=$(a).closest("tr"),f=e.attr("data-key");return $.ajax({url:c,type:"post",data:b+"="+f,success:function(a){var c=a.result;if(c)return e.find(".help-block").html(""),updateRowData(e,b,c),e.removeClass(itChangeCss),void(d||(disableInputs(e),toggleButtons(e)))}}),!1}function editRow(a){var b=$(a).closest("tr");b.attr("data-key");return enableInputs(b),toggleButtons(b),!1}function enableInputs(a){a.find("input").removeAttr("readonly"),a.find("textarea").removeAttr("readonly"),a.find("select").removeAttr("disabled")}function disableInputs(a){a.find("input").attr("readonly",!0),a.find("textarea").attr("readonly",!0),a.find("select").attr("disabled",!0)}function toggleButtons(a,b){return b?(a.find("a.btnsave").removeClass("hidden"),a.find("a.btncancel").removeClass("hidden"),void a.find("a.btnedit").addClass("hidden")):(a.find("a.btnsave").toggleClass("hidden"),a.find("a.btncancel").toggleClass("hidden"),void a.find("a.btnedit").toggleClass("hidden"))}function updateRowData(a,b,c){var d=Object.keys(c),e=a.attr("data-key");for(i=0;i<d.length;i++){var f=d[i];0==e&&f.toLowerCase()==b.toLowerCase()&&a.attr("data-key",c[f]);var g=a.find(".value-"+f);if(g.length>0){var h=g[0];switch(h.nodeName){case"INPUT":$(h).attr("value",c[f]);break;case"TEXTAREA":$(h).text(c[f]);break;case"SELECT":$(h).find('option[value="'+c[f]+'"]').attr("selected",!0)}}}}function deleteRow(a,b,c){if(!confirm("Are you sure you want to delete this row?"))return!1;var d=$(a).closest("tr"),e=d.attr("data-key");return 0==e?(d.remove(),!1):($.ajax({url:c,type:"post",data:b+"="+e,success:function(a){a.result;a.errors||d.remove()}}),!1)}function copyRow(a,b){var c=$(a).closest("tr");return cloneRow(c,b,!0),!1}function createNewRow(a,b){var c=$(a).closest("div.grid-view"),d=c.find("tbody")[0],e=$(d).find("tr"),f=e.length,g=e[f-1];cloneRow($(g),b)}function cloneRow(a,b,c){var d=a.find("input[name]")[0],e=$(d).attr("name"),f=e.indexOf("["),g=e.indexOf("]"),h=e.substring(f+1,g),i=a.closest("tbody")[0],j=$(i).find("tr"),k=j.length,l=a.html(),m="\\["+h+"\\]";l=l.replaceAll(m,"["+k+"]"),l='<tr data-key="0" id="it-row-'+k+'">'+l+"</tr>",$(i).append(l),$newRow=$("#it-row-"+k),c?$newRow.find(".value-"+b).val(""):($newRow.find("input").attr("value",""),$newRow.find("option[selected]").removeAttr("selected"),$newRow.find("textarea").text("")),$firstColumn=$newRow.find("td:first"),0==$firstColumn.children().length&&$firstColumn.html(k+1),toggleButtons($newRow,!0),enableNewSelect2($newRow),enableInputs($newRow),trackInputChange($newRow),null!=itChangeCss&itChangeCss.length>0&&$newRow.addClass(itChangeCss),$newRow.find("input, textarea, select").each(function(a){updatePageSummary($(this))})}function trackInputChange(a){a.find("input, textarea, select").on("change",function(){var a=$(this),b=a.parent().closest("tr");null!=itChangeCss&itChangeCss.length>0&&b.addClass(itChangeCss),updatePageSummary(a)})}function enableNewSelect2(a){var b=a.find("select[data-s2-options]");for(i=0;i<b.length;i++){var c=$(b[i]),d=Math.random().toString(36).substr(2,10),e=c.attr("data-krajee-select2"),f=c.attr("data-s2-options");c.attr("id",d);var g=c.parent();$(g).find("span.select2").remove(),$.when($("#"+d).select2(window[e])).done(initS2Loading(d,window[f]))}}function updatePageSummary(a){var b=a.attr("class").split(" "),c="";for(i=0;i<b.length;i++)if(0==b[i].indexOf("value-")){c=b[i];break}if(c.length>0){var d=c.replace("value-","summary-"),e=$('td[data-field="'+d+'"]'),f=e.attr("data-func"),g=0,h=0;if($("."+c).each(function(a){h++;var b=$(this).val();if(""==b)return!0;switch(b=parseFloat(b),f){case"f_sum":case"f_avg":g+=b;break;case"f_min":1==h?g=b:b<g&&(g=b);break;case"f_max":1==h?g=b:b>g&&(g=b)}}),"f_avg"==f&&(g/=h),"f_count"==f)return void e.text(h);var j=e.attr("data-format");if(null!=j&&j.indexOf("decimal")>=0){j=j.replace("[","").replace("]","");var k=j.split(",");if(k.length>1)return void e.text(g.toFixed(k[1]))}e.text(g)}}String.prototype.replaceAll=function(a,b){var c=this;return c.replace(new RegExp(a,"g"),b)};
